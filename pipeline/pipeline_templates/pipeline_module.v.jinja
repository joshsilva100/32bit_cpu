// Pipeline register '{{ name }}' automatically generated by generate_pipelines.py.
// Used to connect two stages of the pipeline together.
// A list of connected wires is available in generate_pipelines.py
// and the full diagram can be found in pipelined_machine.pdf.
//
// clk - Clock signal. Inputs copy to outputs on rising edge.
// reset - When high, sets all outputs to zeros. Asynchronous
// enable - When high, inputs are copied to outputs on clock edge. When low, outputs remain constant.
// flush - When high, all inputs are set to zero synchronously.
module {{ name }}_reg(
    clk,
    reset,
    enable,
    flush,
{% for signal in signals -%}
{{"\t"}}{{ signal[0] }}_IN,
{{"\t"}}{{ signal[0] }}_OUT{% if not loop.last %},{% endif %}
{% endfor -%}
);

    input clk, reset, enable, flush;
    {% for signal in signals -%}
    input {% if signal[1] > 1 %}[{{ signal[1]-1 }}:0] {% endif %}{{ signal[0] }}_IN;
    output reg {% if signal[1] > 1 %}[{{ signal[1]-1 }}:0] {% endif %}{{ signal[0] }}_OUT;
    {% endfor -%}
{{""}}
    always @(posedge clk or posedge reset) begin
        // On reset, clear all registers to zero
        if (reset || flush) begin
        {% for signal in signals -%}
        {{"    "}}{{ signal[0] }}_OUT <= {{ signal[1] }}'d0;
        {% endfor -%}
        end

        else if (enable) begin
        {% for signal in signals -%}
        {{"    "}}{{ signal[0] }}_OUT <= {{ signal[0] }}_IN;
        {% endfor -%}
        end
    end

endmodule